{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar SymbolDraw = require(\"../helper/SymbolDraw\");\n\nvar LineDraw = require(\"../helper/LineDraw\");\n\nvar RoamController = require(\"../../component/helper/RoamController\");\n\nvar roamHelper = require(\"../../component/helper/roamHelper\");\n\nvar _cursorHelper = require(\"../../component/helper/cursorHelper\");\n\nvar onIrrelevantElement = _cursorHelper.onIrrelevantElement;\n\nvar graphic = require(\"../../util/graphic\");\n\nvar adjustEdge = require(\"./adjustEdge\");\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\nvar FOCUS_ADJACENCY = '__focusNodeAdjacency';\nvar UNFOCUS_ADJACENCY = '__unfocusNodeAdjacency';\nvar nodeOpacityPath = ['itemStyle', 'opacity'];\nvar lineOpacityPath = ['lineStyle', 'opacity'];\n\nfunction getItemOpacity(item, opacityPath) {\n  return item.getVisual('opacity') || item.getModel().get(opacityPath);\n}\n\nfunction fadeOutItem(item, opacityPath, opacityRatio) {\n  var el = item.getGraphicEl();\n  var opacity = getItemOpacity(item, opacityPath);\n\n  if (opacityRatio != null) {\n    opacity == null && (opacity = 1);\n    opacity *= opacityRatio;\n  }\n\n  el.downplay && el.downplay();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      var opct = child.lineLabelOriginalOpacity;\n\n      if (opct == null || opacityRatio != null) {\n        opct = opacity;\n      }\n\n      child.setStyle('opacity', opct);\n    }\n  });\n}\n\nfunction fadeInItem(item, opacityPath) {\n  var opacity = getItemOpacity(item, opacityPath);\n  var el = item.getGraphicEl();\n  el.highlight && el.highlight();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  });\n}\n\nvar _default = echarts.extendChartView({\n  type: 'graph',\n  init: function init(ecModel, api) {\n    var symbolDraw = new SymbolDraw();\n    var lineDraw = new LineDraw();\n    var group = this.group;\n    this._controller = new RoamController(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    group.add(symbolDraw.group);\n    group.add(lineDraw.group);\n    this._symbolDraw = symbolDraw;\n    this._lineDraw = lineDraw;\n    this._firstRender = true;\n  },\n  render: function render(seriesModel, ecModel, api) {\n    var coordSys = seriesModel.coordinateSystem;\n    this._model = seriesModel;\n    this._nodeScaleRatio = seriesModel.get('nodeScaleRatio');\n    var symbolDraw = this._symbolDraw;\n    var lineDraw = this._lineDraw;\n    var group = this.group;\n\n    if (coordSys.type === 'view') {\n      var groupNewProp = {\n        position: coordSys.position,\n        scale: coordSys.scale\n      };\n\n      if (this._firstRender) {\n        group.attr(groupNewProp);\n      } else {\n        graphic.updateProps(group, groupNewProp, seriesModel);\n      }\n    } // Fix edge contact point with node\n\n\n    adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n    var data = seriesModel.getData();\n    symbolDraw.updateData(data);\n    var edgeData = seriesModel.getEdgeData();\n    lineDraw.updateData(edgeData);\n\n    this._updateNodeAndLinkScale();\n\n    this._updateController(seriesModel, ecModel, api);\n\n    clearTimeout(this._layoutTimeout);\n    var forceLayout = seriesModel.forceLayout;\n    var layoutAnimation = seriesModel.get('force.layoutAnimation');\n\n    if (forceLayout) {\n      this._startForceLayoutIteration(forceLayout, layoutAnimation);\n    }\n\n    data.eachItemGraphicEl(function (el, idx) {\n      var itemModel = data.getItemModel(idx); // Update draggable\n\n      el.off('drag').off('dragend');\n      var draggable = itemModel.get('draggable');\n\n      if (draggable) {\n        el.on('drag', function () {\n          if (forceLayout) {\n            forceLayout.warmUp();\n            !this._layouting && this._startForceLayoutIteration(forceLayout, layoutAnimation);\n            forceLayout.setFixed(idx); // Write position back to layout\n\n            data.setItemLayout(idx, el.position);\n          }\n        }, this).on('dragend', function () {\n          if (forceLayout) {\n            forceLayout.setUnfixed(idx);\n          }\n        }, this);\n      }\n\n      el.setDraggable(draggable && forceLayout);\n      el[FOCUS_ADJACENCY] && el.off('mouseover', el[FOCUS_ADJACENCY]);\n      el[UNFOCUS_ADJACENCY] && el.off('mouseout', el[UNFOCUS_ADJACENCY]);\n\n      if (itemModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el[FOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'focusNodeAdjacency',\n            seriesId: seriesModel.id,\n            dataIndex: el.dataIndex\n          });\n        });\n        el.on('mouseout', el[UNFOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'unfocusNodeAdjacency',\n            seriesId: seriesModel.id\n          });\n        });\n      }\n    }, this);\n    data.graph.eachEdge(function (edge) {\n      var el = edge.getGraphicEl();\n      el[FOCUS_ADJACENCY] && el.off('mouseover', el[FOCUS_ADJACENCY]);\n      el[UNFOCUS_ADJACENCY] && el.off('mouseout', el[UNFOCUS_ADJACENCY]);\n\n      if (edge.getModel().get('focusNodeAdjacency')) {\n        el.on('mouseover', el[FOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'focusNodeAdjacency',\n            seriesId: seriesModel.id,\n            edgeDataIndex: edge.dataIndex\n          });\n        });\n        el.on('mouseout', el[UNFOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'unfocusNodeAdjacency',\n            seriesId: seriesModel.id\n          });\n        });\n      }\n    });\n    var circularRotateLabel = seriesModel.get('layout') === 'circular' && seriesModel.get('circular.rotateLabel');\n    var cx = data.getLayout('cx');\n    var cy = data.getLayout('cy');\n    data.eachItemGraphicEl(function (el, idx) {\n      var symbolPath = el.getSymbolPath();\n\n      if (circularRotateLabel) {\n        var pos = data.getItemLayout(idx);\n        var rad = Math.atan2(pos[1] - cy, pos[0] - cx);\n\n        if (rad < 0) {\n          rad = Math.PI * 2 + rad;\n        }\n\n        var isLeft = pos[0] < cx;\n\n        if (isLeft) {\n          rad = rad - Math.PI;\n        }\n\n        var textPosition = isLeft ? 'left' : 'right';\n        symbolPath.setStyle({\n          textRotation: -rad,\n          textPosition: textPosition,\n          textOrigin: 'center'\n        });\n        symbolPath.hoverStyle && (symbolPath.hoverStyle.textPosition = textPosition);\n      } else {\n        symbolPath.setStyle({\n          textRotation: 0\n        });\n      }\n    });\n    this._firstRender = false;\n  },\n  dispose: function dispose() {\n    this._controller && this._controller.dispose();\n    this._controllerHost = {};\n  },\n  focusNodeAdjacency: function focusNodeAdjacency(seriesModel, ecModel, api, payload) {\n    var data = this._model.getData();\n\n    var graph = data.graph;\n    var dataIndex = payload.dataIndex;\n    var edgeDataIndex = payload.edgeDataIndex;\n    var node = graph.getNodeByIndex(dataIndex);\n    var edge = graph.getEdgeByIndex(edgeDataIndex);\n\n    if (!node && !edge) {\n      return;\n    }\n\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath, 0.1);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath, 0.1);\n    });\n\n    if (node) {\n      fadeInItem(node, nodeOpacityPath);\n      zrUtil.each(node.edges, function (adjacentEdge) {\n        if (adjacentEdge.dataIndex < 0) {\n          return;\n        }\n\n        fadeInItem(adjacentEdge, lineOpacityPath);\n        fadeInItem(adjacentEdge.node1, nodeOpacityPath);\n        fadeInItem(adjacentEdge.node2, nodeOpacityPath);\n      });\n    }\n\n    if (edge) {\n      fadeInItem(edge, lineOpacityPath);\n      fadeInItem(edge.node1, nodeOpacityPath);\n      fadeInItem(edge.node2, nodeOpacityPath);\n    }\n  },\n  unfocusNodeAdjacency: function unfocusNodeAdjacency(seriesModel, ecModel, api, payload) {\n    var graph = this._model.getData().graph;\n\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath);\n    });\n  },\n  _startForceLayoutIteration: function _startForceLayoutIteration(forceLayout, layoutAnimation) {\n    var self = this;\n\n    (function step() {\n      forceLayout.step(function (stopped) {\n        self.updateLayout(self._model);\n        (self._layouting = !stopped) && (layoutAnimation ? self._layoutTimeout = setTimeout(step, 16) : step());\n      });\n    })();\n  },\n  _updateController: function _updateController(seriesModel, ecModel, api) {\n    var controller = this._controller;\n    var controllerHost = this._controllerHost;\n    var group = this.group;\n    controller.setPointerChecker(function (e, x, y) {\n      var rect = group.getBoundingRect();\n      rect.applyTransform(group.transform);\n      return rect.contain(x, y) && !onIrrelevantElement(e, api, seriesModel);\n    });\n\n    if (seriesModel.coordinateSystem.type !== 'view') {\n      controller.disable();\n      return;\n    }\n\n    controller.enable(seriesModel.get('roam'));\n    controllerHost.zoomLimit = seriesModel.get('scaleLimit');\n    controllerHost.zoom = seriesModel.coordinateSystem.getZoom();\n    controller.off('pan').off('zoom').on('pan', function (e) {\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction({\n        seriesId: seriesModel.id,\n        type: 'graphRoam',\n        dx: e.dx,\n        dy: e.dy\n      });\n    }).on('zoom', function (e) {\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction({\n        seriesId: seriesModel.id,\n        type: 'graphRoam',\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY\n      });\n\n      this._updateNodeAndLinkScale();\n\n      adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n\n      this._lineDraw.updateLayout();\n    }, this);\n  },\n  _updateNodeAndLinkScale: function _updateNodeAndLinkScale() {\n    var seriesModel = this._model;\n    var data = seriesModel.getData();\n\n    var nodeScale = this._getNodeGlobalScale(seriesModel);\n\n    var invScale = [nodeScale, nodeScale];\n    data.eachItemGraphicEl(function (el, idx) {\n      el.attr('scale', invScale);\n    });\n  },\n  _getNodeGlobalScale: function _getNodeGlobalScale(seriesModel) {\n    var coordSys = seriesModel.coordinateSystem;\n\n    if (coordSys.type !== 'view') {\n      return 1;\n    }\n\n    var nodeScaleRatio = this._nodeScaleRatio;\n    var groupScale = coordSys.scale;\n    var groupZoom = groupScale && groupScale[0] || 1; // Scale node when zoom changes\n\n    var roamZoom = coordSys.getZoom();\n    var nodeScale = (roamZoom - 1) * nodeScaleRatio + 1;\n    return nodeScale / groupZoom;\n  },\n  updateLayout: function updateLayout(seriesModel) {\n    adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n\n    this._symbolDraw.updateLayout();\n\n    this._lineDraw.updateLayout();\n  },\n  remove: function remove(ecModel, api) {\n    this._symbolDraw && this._symbolDraw.remove();\n    this._lineDraw && this._lineDraw.remove();\n  }\n});\n\nmodule.exports = _default;","map":{"version":3,"sources":["/Users/eduardjacobs/Desktop/files/inHouse-website/client/node_modules/echarts/lib/chart/graph/GraphView.js"],"names":["echarts","require","zrUtil","SymbolDraw","LineDraw","RoamController","roamHelper","_cursorHelper","onIrrelevantElement","graphic","adjustEdge","FOCUS_ADJACENCY","UNFOCUS_ADJACENCY","nodeOpacityPath","lineOpacityPath","getItemOpacity","item","opacityPath","getVisual","getModel","get","fadeOutItem","opacityRatio","el","getGraphicEl","opacity","downplay","traverse","child","type","opct","lineLabelOriginalOpacity","setStyle","fadeInItem","highlight","_default","extendChartView","init","ecModel","api","symbolDraw","lineDraw","group","_controller","getZr","_controllerHost","target","add","_symbolDraw","_lineDraw","_firstRender","render","seriesModel","coordSys","coordinateSystem","_model","_nodeScaleRatio","groupNewProp","position","scale","attr","updateProps","getGraph","_getNodeGlobalScale","data","getData","updateData","edgeData","getEdgeData","_updateNodeAndLinkScale","_updateController","clearTimeout","_layoutTimeout","forceLayout","layoutAnimation","_startForceLayoutIteration","eachItemGraphicEl","idx","itemModel","getItemModel","off","draggable","on","warmUp","_layouting","setFixed","setItemLayout","setUnfixed","setDraggable","dispatchAction","seriesId","id","dataIndex","graph","eachEdge","edge","edgeDataIndex","circularRotateLabel","cx","getLayout","cy","symbolPath","getSymbolPath","pos","getItemLayout","rad","Math","atan2","PI","isLeft","textPosition","textRotation","textOrigin","hoverStyle","dispose","focusNodeAdjacency","payload","node","getNodeByIndex","getEdgeByIndex","eachNode","each","edges","adjacentEdge","node1","node2","unfocusNodeAdjacency","self","step","stopped","updateLayout","setTimeout","controller","controllerHost","setPointerChecker","e","x","y","rect","getBoundingRect","applyTransform","transform","contain","disable","enable","zoomLimit","zoom","getZoom","updateViewOnPan","dx","dy","updateViewOnZoom","originX","originY","nodeScale","invScale","nodeScaleRatio","groupScale","groupZoom","roamZoom","remove","module","exports"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar SymbolDraw = require(\"../helper/SymbolDraw\");\n\nvar LineDraw = require(\"../helper/LineDraw\");\n\nvar RoamController = require(\"../../component/helper/RoamController\");\n\nvar roamHelper = require(\"../../component/helper/roamHelper\");\n\nvar _cursorHelper = require(\"../../component/helper/cursorHelper\");\n\nvar onIrrelevantElement = _cursorHelper.onIrrelevantElement;\n\nvar graphic = require(\"../../util/graphic\");\n\nvar adjustEdge = require(\"./adjustEdge\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar FOCUS_ADJACENCY = '__focusNodeAdjacency';\nvar UNFOCUS_ADJACENCY = '__unfocusNodeAdjacency';\nvar nodeOpacityPath = ['itemStyle', 'opacity'];\nvar lineOpacityPath = ['lineStyle', 'opacity'];\n\nfunction getItemOpacity(item, opacityPath) {\n  return item.getVisual('opacity') || item.getModel().get(opacityPath);\n}\n\nfunction fadeOutItem(item, opacityPath, opacityRatio) {\n  var el = item.getGraphicEl();\n  var opacity = getItemOpacity(item, opacityPath);\n\n  if (opacityRatio != null) {\n    opacity == null && (opacity = 1);\n    opacity *= opacityRatio;\n  }\n\n  el.downplay && el.downplay();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      var opct = child.lineLabelOriginalOpacity;\n\n      if (opct == null || opacityRatio != null) {\n        opct = opacity;\n      }\n\n      child.setStyle('opacity', opct);\n    }\n  });\n}\n\nfunction fadeInItem(item, opacityPath) {\n  var opacity = getItemOpacity(item, opacityPath);\n  var el = item.getGraphicEl();\n  el.highlight && el.highlight();\n  el.traverse(function (child) {\n    if (child.type !== 'group') {\n      child.setStyle('opacity', opacity);\n    }\n  });\n}\n\nvar _default = echarts.extendChartView({\n  type: 'graph',\n  init: function (ecModel, api) {\n    var symbolDraw = new SymbolDraw();\n    var lineDraw = new LineDraw();\n    var group = this.group;\n    this._controller = new RoamController(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    group.add(symbolDraw.group);\n    group.add(lineDraw.group);\n    this._symbolDraw = symbolDraw;\n    this._lineDraw = lineDraw;\n    this._firstRender = true;\n  },\n  render: function (seriesModel, ecModel, api) {\n    var coordSys = seriesModel.coordinateSystem;\n    this._model = seriesModel;\n    this._nodeScaleRatio = seriesModel.get('nodeScaleRatio');\n    var symbolDraw = this._symbolDraw;\n    var lineDraw = this._lineDraw;\n    var group = this.group;\n\n    if (coordSys.type === 'view') {\n      var groupNewProp = {\n        position: coordSys.position,\n        scale: coordSys.scale\n      };\n\n      if (this._firstRender) {\n        group.attr(groupNewProp);\n      } else {\n        graphic.updateProps(group, groupNewProp, seriesModel);\n      }\n    } // Fix edge contact point with node\n\n\n    adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n    var data = seriesModel.getData();\n    symbolDraw.updateData(data);\n    var edgeData = seriesModel.getEdgeData();\n    lineDraw.updateData(edgeData);\n\n    this._updateNodeAndLinkScale();\n\n    this._updateController(seriesModel, ecModel, api);\n\n    clearTimeout(this._layoutTimeout);\n    var forceLayout = seriesModel.forceLayout;\n    var layoutAnimation = seriesModel.get('force.layoutAnimation');\n\n    if (forceLayout) {\n      this._startForceLayoutIteration(forceLayout, layoutAnimation);\n    }\n\n    data.eachItemGraphicEl(function (el, idx) {\n      var itemModel = data.getItemModel(idx); // Update draggable\n\n      el.off('drag').off('dragend');\n      var draggable = itemModel.get('draggable');\n\n      if (draggable) {\n        el.on('drag', function () {\n          if (forceLayout) {\n            forceLayout.warmUp();\n            !this._layouting && this._startForceLayoutIteration(forceLayout, layoutAnimation);\n            forceLayout.setFixed(idx); // Write position back to layout\n\n            data.setItemLayout(idx, el.position);\n          }\n        }, this).on('dragend', function () {\n          if (forceLayout) {\n            forceLayout.setUnfixed(idx);\n          }\n        }, this);\n      }\n\n      el.setDraggable(draggable && forceLayout);\n      el[FOCUS_ADJACENCY] && el.off('mouseover', el[FOCUS_ADJACENCY]);\n      el[UNFOCUS_ADJACENCY] && el.off('mouseout', el[UNFOCUS_ADJACENCY]);\n\n      if (itemModel.get('focusNodeAdjacency')) {\n        el.on('mouseover', el[FOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'focusNodeAdjacency',\n            seriesId: seriesModel.id,\n            dataIndex: el.dataIndex\n          });\n        });\n        el.on('mouseout', el[UNFOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'unfocusNodeAdjacency',\n            seriesId: seriesModel.id\n          });\n        });\n      }\n    }, this);\n    data.graph.eachEdge(function (edge) {\n      var el = edge.getGraphicEl();\n      el[FOCUS_ADJACENCY] && el.off('mouseover', el[FOCUS_ADJACENCY]);\n      el[UNFOCUS_ADJACENCY] && el.off('mouseout', el[UNFOCUS_ADJACENCY]);\n\n      if (edge.getModel().get('focusNodeAdjacency')) {\n        el.on('mouseover', el[FOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'focusNodeAdjacency',\n            seriesId: seriesModel.id,\n            edgeDataIndex: edge.dataIndex\n          });\n        });\n        el.on('mouseout', el[UNFOCUS_ADJACENCY] = function () {\n          api.dispatchAction({\n            type: 'unfocusNodeAdjacency',\n            seriesId: seriesModel.id\n          });\n        });\n      }\n    });\n    var circularRotateLabel = seriesModel.get('layout') === 'circular' && seriesModel.get('circular.rotateLabel');\n    var cx = data.getLayout('cx');\n    var cy = data.getLayout('cy');\n    data.eachItemGraphicEl(function (el, idx) {\n      var symbolPath = el.getSymbolPath();\n\n      if (circularRotateLabel) {\n        var pos = data.getItemLayout(idx);\n        var rad = Math.atan2(pos[1] - cy, pos[0] - cx);\n\n        if (rad < 0) {\n          rad = Math.PI * 2 + rad;\n        }\n\n        var isLeft = pos[0] < cx;\n\n        if (isLeft) {\n          rad = rad - Math.PI;\n        }\n\n        var textPosition = isLeft ? 'left' : 'right';\n        symbolPath.setStyle({\n          textRotation: -rad,\n          textPosition: textPosition,\n          textOrigin: 'center'\n        });\n        symbolPath.hoverStyle && (symbolPath.hoverStyle.textPosition = textPosition);\n      } else {\n        symbolPath.setStyle({\n          textRotation: 0\n        });\n      }\n    });\n    this._firstRender = false;\n  },\n  dispose: function () {\n    this._controller && this._controller.dispose();\n    this._controllerHost = {};\n  },\n  focusNodeAdjacency: function (seriesModel, ecModel, api, payload) {\n    var data = this._model.getData();\n\n    var graph = data.graph;\n    var dataIndex = payload.dataIndex;\n    var edgeDataIndex = payload.edgeDataIndex;\n    var node = graph.getNodeByIndex(dataIndex);\n    var edge = graph.getEdgeByIndex(edgeDataIndex);\n\n    if (!node && !edge) {\n      return;\n    }\n\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath, 0.1);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath, 0.1);\n    });\n\n    if (node) {\n      fadeInItem(node, nodeOpacityPath);\n      zrUtil.each(node.edges, function (adjacentEdge) {\n        if (adjacentEdge.dataIndex < 0) {\n          return;\n        }\n\n        fadeInItem(adjacentEdge, lineOpacityPath);\n        fadeInItem(adjacentEdge.node1, nodeOpacityPath);\n        fadeInItem(adjacentEdge.node2, nodeOpacityPath);\n      });\n    }\n\n    if (edge) {\n      fadeInItem(edge, lineOpacityPath);\n      fadeInItem(edge.node1, nodeOpacityPath);\n      fadeInItem(edge.node2, nodeOpacityPath);\n    }\n  },\n  unfocusNodeAdjacency: function (seriesModel, ecModel, api, payload) {\n    var graph = this._model.getData().graph;\n\n    graph.eachNode(function (node) {\n      fadeOutItem(node, nodeOpacityPath);\n    });\n    graph.eachEdge(function (edge) {\n      fadeOutItem(edge, lineOpacityPath);\n    });\n  },\n  _startForceLayoutIteration: function (forceLayout, layoutAnimation) {\n    var self = this;\n\n    (function step() {\n      forceLayout.step(function (stopped) {\n        self.updateLayout(self._model);\n        (self._layouting = !stopped) && (layoutAnimation ? self._layoutTimeout = setTimeout(step, 16) : step());\n      });\n    })();\n  },\n  _updateController: function (seriesModel, ecModel, api) {\n    var controller = this._controller;\n    var controllerHost = this._controllerHost;\n    var group = this.group;\n    controller.setPointerChecker(function (e, x, y) {\n      var rect = group.getBoundingRect();\n      rect.applyTransform(group.transform);\n      return rect.contain(x, y) && !onIrrelevantElement(e, api, seriesModel);\n    });\n\n    if (seriesModel.coordinateSystem.type !== 'view') {\n      controller.disable();\n      return;\n    }\n\n    controller.enable(seriesModel.get('roam'));\n    controllerHost.zoomLimit = seriesModel.get('scaleLimit');\n    controllerHost.zoom = seriesModel.coordinateSystem.getZoom();\n    controller.off('pan').off('zoom').on('pan', function (e) {\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction({\n        seriesId: seriesModel.id,\n        type: 'graphRoam',\n        dx: e.dx,\n        dy: e.dy\n      });\n    }).on('zoom', function (e) {\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction({\n        seriesId: seriesModel.id,\n        type: 'graphRoam',\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY\n      });\n\n      this._updateNodeAndLinkScale();\n\n      adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n\n      this._lineDraw.updateLayout();\n    }, this);\n  },\n  _updateNodeAndLinkScale: function () {\n    var seriesModel = this._model;\n    var data = seriesModel.getData();\n\n    var nodeScale = this._getNodeGlobalScale(seriesModel);\n\n    var invScale = [nodeScale, nodeScale];\n    data.eachItemGraphicEl(function (el, idx) {\n      el.attr('scale', invScale);\n    });\n  },\n  _getNodeGlobalScale: function (seriesModel) {\n    var coordSys = seriesModel.coordinateSystem;\n\n    if (coordSys.type !== 'view') {\n      return 1;\n    }\n\n    var nodeScaleRatio = this._nodeScaleRatio;\n    var groupScale = coordSys.scale;\n    var groupZoom = groupScale && groupScale[0] || 1; // Scale node when zoom changes\n\n    var roamZoom = coordSys.getZoom();\n    var nodeScale = (roamZoom - 1) * nodeScaleRatio + 1;\n    return nodeScale / groupZoom;\n  },\n  updateLayout: function (seriesModel) {\n    adjustEdge(seriesModel.getGraph(), this._getNodeGlobalScale(seriesModel));\n\n    this._symbolDraw.updateLayout();\n\n    this._lineDraw.updateLayout();\n  },\n  remove: function (ecModel, api) {\n    this._symbolDraw && this._symbolDraw.remove();\n    this._lineDraw && this._lineDraw.remove();\n  }\n});\n\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}