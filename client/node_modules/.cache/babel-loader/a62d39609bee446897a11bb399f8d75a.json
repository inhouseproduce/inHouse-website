{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar textContain = require(\"zrender/lib/contain/text\");\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// FIXME emphasis label position is not same with normal label position\n\n\nfunction adjustSingleSide(list, cx, cy, r, dir, viewWidth, viewHeight) {\n  list.sort(function (a, b) {\n    return a.y - b.y;\n  });\n\n  function shiftDown(start, end, delta, dir) {\n    for (var j = start; j < end; j++) {\n      list[j].y += delta;\n\n      if (j > start && j + 1 < end && list[j + 1].y > list[j].y + list[j].height) {\n        shiftUp(j, delta / 2);\n        return;\n      }\n    }\n\n    shiftUp(end - 1, delta / 2);\n  }\n\n  function shiftUp(end, delta) {\n    for (var j = end; j >= 0; j--) {\n      list[j].y -= delta;\n\n      if (j > 0 && list[j].y > list[j - 1].y + list[j - 1].height) {\n        break;\n      }\n    }\n  }\n\n  function changeX(list, isDownList, cx, cy, r, dir) {\n    var lastDeltaX = dir > 0 ? isDownList // right-side\n    ? Number.MAX_VALUE // down\n    : 0 // up\n    : isDownList // left-side\n    ? Number.MAX_VALUE // down\n    : 0; // up\n\n    for (var i = 0, l = list.length; i < l; i++) {\n      var deltaY = Math.abs(list[i].y - cy);\n      var length = list[i].len;\n      var length2 = list[i].len2;\n      var deltaX = deltaY < r + length ? Math.sqrt((r + length + length2) * (r + length + length2) - deltaY * deltaY) : Math.abs(list[i].x - cx);\n\n      if (isDownList && deltaX >= lastDeltaX) {\n        // right-down, left-down\n        deltaX = lastDeltaX - 10;\n      }\n\n      if (!isDownList && deltaX <= lastDeltaX) {\n        // right-up, left-up\n        deltaX = lastDeltaX + 10;\n      }\n\n      list[i].x = cx + deltaX * dir;\n      lastDeltaX = deltaX;\n    }\n  }\n\n  var lastY = 0;\n  var delta;\n  var len = list.length;\n  var upList = [];\n  var downList = [];\n\n  for (var i = 0; i < len; i++) {\n    delta = list[i].y - lastY;\n\n    if (delta < 0) {\n      shiftDown(i, len, -delta, dir);\n    }\n\n    lastY = list[i].y + list[i].height;\n  }\n\n  if (viewHeight - lastY < 0) {\n    shiftUp(len - 1, lastY - viewHeight);\n  }\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].y >= cy) {\n      downList.push(list[i]);\n    } else {\n      upList.push(list[i]);\n    }\n  }\n\n  changeX(upList, false, cx, cy, r, dir);\n  changeX(downList, true, cx, cy, r, dir);\n}\n\nfunction avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight) {\n  var leftList = [];\n  var rightList = [];\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    if (labelLayoutList[i].x < cx) {\n      leftList.push(labelLayoutList[i]);\n    } else {\n      rightList.push(labelLayoutList[i]);\n    }\n  }\n\n  adjustSingleSide(rightList, cx, cy, r, 1, viewWidth, viewHeight);\n  adjustSingleSide(leftList, cx, cy, r, -1, viewWidth, viewHeight);\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    var linePoints = labelLayoutList[i].linePoints;\n\n    if (linePoints) {\n      var dist = linePoints[1][0] - linePoints[2][0];\n\n      if (labelLayoutList[i].x < cx) {\n        linePoints[2][0] = labelLayoutList[i].x + 3;\n      } else {\n        linePoints[2][0] = labelLayoutList[i].x - 3;\n      }\n\n      linePoints[1][1] = linePoints[2][1] = labelLayoutList[i].y;\n      linePoints[1][0] = linePoints[2][0] + dist;\n    }\n  }\n}\n\nfunction isPositionCenter(layout) {\n  // Not change x for center label\n  return layout.position === 'center';\n}\n\nfunction _default(seriesModel, r, viewWidth, viewHeight) {\n  var data = seriesModel.getData();\n  var labelLayoutList = [];\n  var cx;\n  var cy;\n  var hasLabelRotate = false;\n  data.each(function (idx) {\n    var layout = data.getItemLayout(idx);\n    var itemModel = data.getItemModel(idx);\n    var labelModel = itemModel.getModel('label'); // Use position in normal or emphasis\n\n    var labelPosition = labelModel.get('position') || itemModel.get('emphasis.label.position');\n    var labelLineModel = itemModel.getModel('labelLine');\n    var labelLineLen = labelLineModel.get('length');\n    var labelLineLen2 = labelLineModel.get('length2');\n    var midAngle = (layout.startAngle + layout.endAngle) / 2;\n    var dx = Math.cos(midAngle);\n    var dy = Math.sin(midAngle);\n    var textX;\n    var textY;\n    var linePoints;\n    var textAlign;\n    cx = layout.cx;\n    cy = layout.cy;\n    var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';\n\n    if (labelPosition === 'center') {\n      textX = layout.cx;\n      textY = layout.cy;\n      textAlign = 'center';\n    } else {\n      var x1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dx : layout.r * dx) + cx;\n      var y1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dy : layout.r * dy) + cy;\n      textX = x1 + dx * 3;\n      textY = y1 + dy * 3;\n\n      if (!isLabelInside) {\n        // For roseType\n        var x2 = x1 + dx * (labelLineLen + r - layout.r);\n        var y2 = y1 + dy * (labelLineLen + r - layout.r);\n        var x3 = x2 + (dx < 0 ? -1 : 1) * labelLineLen2;\n        var y3 = y2;\n        textX = x3 + (dx < 0 ? -5 : 5);\n        textY = y3;\n        linePoints = [[x1, y1], [x2, y2], [x3, y3]];\n      }\n\n      textAlign = isLabelInside ? 'center' : dx > 0 ? 'left' : 'right';\n    }\n\n    var font = labelModel.getFont();\n    var labelRotate = labelModel.get('rotate') ? dx < 0 ? -midAngle + Math.PI : -midAngle : 0;\n    var text = seriesModel.getFormattedLabel(idx, 'normal') || data.getName(idx);\n    var textRect = textContain.getBoundingRect(text, font, textAlign, 'top');\n    hasLabelRotate = !!labelRotate;\n    layout.label = {\n      x: textX,\n      y: textY,\n      position: labelPosition,\n      height: textRect.height,\n      len: labelLineLen,\n      len2: labelLineLen2,\n      linePoints: linePoints,\n      textAlign: textAlign,\n      verticalAlign: 'middle',\n      rotation: labelRotate,\n      inside: isLabelInside\n    }; // Not layout the inside label\n\n    if (!isLabelInside) {\n      labelLayoutList.push(layout.label);\n    }\n  });\n\n  if (!hasLabelRotate && seriesModel.get('avoidLabelOverlap')) {\n    avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight);\n  }\n}\n\nmodule.exports = _default;","map":{"version":3,"sources":["/Users/eduardjacobs/Desktop/files/inHouse-website/client/node_modules/echarts/lib/chart/pie/labelLayout.js"],"names":["textContain","require","adjustSingleSide","list","cx","cy","r","dir","viewWidth","viewHeight","sort","a","b","y","shiftDown","start","end","delta","j","height","shiftUp","changeX","isDownList","lastDeltaX","Number","MAX_VALUE","i","l","length","deltaY","Math","abs","len","length2","len2","deltaX","sqrt","x","lastY","upList","downList","push","avoidOverlap","labelLayoutList","leftList","rightList","isPositionCenter","linePoints","dist","layout","position","_default","seriesModel","data","getData","hasLabelRotate","each","idx","getItemLayout","itemModel","getItemModel","labelModel","getModel","labelPosition","get","labelLineModel","labelLineLen","labelLineLen2","midAngle","startAngle","endAngle","dx","cos","dy","sin","textX","textY","textAlign","isLabelInside","x1","r0","y1","x2","y2","x3","y3","font","getFont","labelRotate","PI","text","getFormattedLabel","getName","textRect","getBoundingRect","label","verticalAlign","rotation","inside","module","exports"],"mappings":"AACA;;;;;;;;;;;;;;;;;;AAmBA,IAAIA,WAAW,GAAGC,OAAO,CAAC,0BAAD,CAAzB;AAEA;;;;;;;;;;;;;;;;;;AAkBA;;;AACA,SAASC,gBAAT,CAA0BC,IAA1B,EAAgCC,EAAhC,EAAoCC,EAApC,EAAwCC,CAAxC,EAA2CC,GAA3C,EAAgDC,SAAhD,EAA2DC,UAA3D,EAAuE;AACrEN,EAAAA,IAAI,CAACO,IAAL,CAAU,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AACxB,WAAOD,CAAC,CAACE,CAAF,GAAMD,CAAC,CAACC,CAAf;AACD,GAFD;;AAIA,WAASC,SAAT,CAAmBC,KAAnB,EAA0BC,GAA1B,EAA+BC,KAA/B,EAAsCV,GAAtC,EAA2C;AACzC,SAAK,IAAIW,CAAC,GAAGH,KAAb,EAAoBG,CAAC,GAAGF,GAAxB,EAA6BE,CAAC,EAA9B,EAAkC;AAChCf,MAAAA,IAAI,CAACe,CAAD,CAAJ,CAAQL,CAAR,IAAaI,KAAb;;AAEA,UAAIC,CAAC,GAAGH,KAAJ,IAAaG,CAAC,GAAG,CAAJ,GAAQF,GAArB,IAA4Bb,IAAI,CAACe,CAAC,GAAG,CAAL,CAAJ,CAAYL,CAAZ,GAAgBV,IAAI,CAACe,CAAD,CAAJ,CAAQL,CAAR,GAAYV,IAAI,CAACe,CAAD,CAAJ,CAAQC,MAApE,EAA4E;AAC1EC,QAAAA,OAAO,CAACF,CAAD,EAAID,KAAK,GAAG,CAAZ,CAAP;AACA;AACD;AACF;;AAEDG,IAAAA,OAAO,CAACJ,GAAG,GAAG,CAAP,EAAUC,KAAK,GAAG,CAAlB,CAAP;AACD;;AAED,WAASG,OAAT,CAAiBJ,GAAjB,EAAsBC,KAAtB,EAA6B;AAC3B,SAAK,IAAIC,CAAC,GAAGF,GAAb,EAAkBE,CAAC,IAAI,CAAvB,EAA0BA,CAAC,EAA3B,EAA+B;AAC7Bf,MAAAA,IAAI,CAACe,CAAD,CAAJ,CAAQL,CAAR,IAAaI,KAAb;;AAEA,UAAIC,CAAC,GAAG,CAAJ,IAASf,IAAI,CAACe,CAAD,CAAJ,CAAQL,CAAR,GAAYV,IAAI,CAACe,CAAC,GAAG,CAAL,CAAJ,CAAYL,CAAZ,GAAgBV,IAAI,CAACe,CAAC,GAAG,CAAL,CAAJ,CAAYC,MAArD,EAA6D;AAC3D;AACD;AACF;AACF;;AAED,WAASE,OAAT,CAAiBlB,IAAjB,EAAuBmB,UAAvB,EAAmClB,EAAnC,EAAuCC,EAAvC,EAA2CC,CAA3C,EAA8CC,GAA9C,EAAmD;AACjD,QAAIgB,UAAU,GAAGhB,GAAG,GAAG,CAAN,GAAUe,UAAU,CAAC;AAAD,MACnCE,MAAM,CAACC,SAD4B,CAClB;AADkB,MAEnC,CAFe,CAEb;AAFa,MAGfH,UAAU,CAAC;AAAD,MACVE,MAAM,CAACC,SADG,CACO;AADP,MAEV,CALF,CADiD,CAM5C;;AAEL,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGxB,IAAI,CAACyB,MAAzB,EAAiCF,CAAC,GAAGC,CAArC,EAAwCD,CAAC,EAAzC,EAA6C;AAC3C,UAAIG,MAAM,GAAGC,IAAI,CAACC,GAAL,CAAS5B,IAAI,CAACuB,CAAD,CAAJ,CAAQb,CAAR,GAAYR,EAArB,CAAb;AACA,UAAIuB,MAAM,GAAGzB,IAAI,CAACuB,CAAD,CAAJ,CAAQM,GAArB;AACA,UAAIC,OAAO,GAAG9B,IAAI,CAACuB,CAAD,CAAJ,CAAQQ,IAAtB;AACA,UAAIC,MAAM,GAAGN,MAAM,GAAGvB,CAAC,GAAGsB,MAAb,GAAsBE,IAAI,CAACM,IAAL,CAAU,CAAC9B,CAAC,GAAGsB,MAAJ,GAAaK,OAAd,KAA0B3B,CAAC,GAAGsB,MAAJ,GAAaK,OAAvC,IAAkDJ,MAAM,GAAGA,MAArE,CAAtB,GAAqGC,IAAI,CAACC,GAAL,CAAS5B,IAAI,CAACuB,CAAD,CAAJ,CAAQW,CAAR,GAAYjC,EAArB,CAAlH;;AAEA,UAAIkB,UAAU,IAAIa,MAAM,IAAIZ,UAA5B,EAAwC;AACtC;AACAY,QAAAA,MAAM,GAAGZ,UAAU,GAAG,EAAtB;AACD;;AAED,UAAI,CAACD,UAAD,IAAea,MAAM,IAAIZ,UAA7B,EAAyC;AACvC;AACAY,QAAAA,MAAM,GAAGZ,UAAU,GAAG,EAAtB;AACD;;AAEDpB,MAAAA,IAAI,CAACuB,CAAD,CAAJ,CAAQW,CAAR,GAAYjC,EAAE,GAAG+B,MAAM,GAAG5B,GAA1B;AACAgB,MAAAA,UAAU,GAAGY,MAAb;AACD;AACF;;AAED,MAAIG,KAAK,GAAG,CAAZ;AACA,MAAIrB,KAAJ;AACA,MAAIe,GAAG,GAAG7B,IAAI,CAACyB,MAAf;AACA,MAAIW,MAAM,GAAG,EAAb;AACA,MAAIC,QAAQ,GAAG,EAAf;;AAEA,OAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,GAApB,EAAyBN,CAAC,EAA1B,EAA8B;AAC5BT,IAAAA,KAAK,GAAGd,IAAI,CAACuB,CAAD,CAAJ,CAAQb,CAAR,GAAYyB,KAApB;;AAEA,QAAIrB,KAAK,GAAG,CAAZ,EAAe;AACbH,MAAAA,SAAS,CAACY,CAAD,EAAIM,GAAJ,EAAS,CAACf,KAAV,EAAiBV,GAAjB,CAAT;AACD;;AAED+B,IAAAA,KAAK,GAAGnC,IAAI,CAACuB,CAAD,CAAJ,CAAQb,CAAR,GAAYV,IAAI,CAACuB,CAAD,CAAJ,CAAQP,MAA5B;AACD;;AAED,MAAIV,UAAU,GAAG6B,KAAb,GAAqB,CAAzB,EAA4B;AAC1BlB,IAAAA,OAAO,CAACY,GAAG,GAAG,CAAP,EAAUM,KAAK,GAAG7B,UAAlB,CAAP;AACD;;AAED,OAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,GAApB,EAAyBN,CAAC,EAA1B,EAA8B;AAC5B,QAAIvB,IAAI,CAACuB,CAAD,CAAJ,CAAQb,CAAR,IAAaR,EAAjB,EAAqB;AACnBmC,MAAAA,QAAQ,CAACC,IAAT,CAActC,IAAI,CAACuB,CAAD,CAAlB;AACD,KAFD,MAEO;AACLa,MAAAA,MAAM,CAACE,IAAP,CAAYtC,IAAI,CAACuB,CAAD,CAAhB;AACD;AACF;;AAEDL,EAAAA,OAAO,CAACkB,MAAD,EAAS,KAAT,EAAgBnC,EAAhB,EAAoBC,EAApB,EAAwBC,CAAxB,EAA2BC,GAA3B,CAAP;AACAc,EAAAA,OAAO,CAACmB,QAAD,EAAW,IAAX,EAAiBpC,EAAjB,EAAqBC,EAArB,EAAyBC,CAAzB,EAA4BC,GAA5B,CAAP;AACD;;AAED,SAASmC,YAAT,CAAsBC,eAAtB,EAAuCvC,EAAvC,EAA2CC,EAA3C,EAA+CC,CAA/C,EAAkDE,SAAlD,EAA6DC,UAA7D,EAAyE;AACvE,MAAImC,QAAQ,GAAG,EAAf;AACA,MAAIC,SAAS,GAAG,EAAhB;;AAEA,OAAK,IAAInB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiB,eAAe,CAACf,MAApC,EAA4CF,CAAC,EAA7C,EAAiD;AAC/C,QAAIoB,gBAAgB,CAACH,eAAe,CAACjB,CAAD,CAAhB,CAApB,EAA0C;AACxC;AACD;;AAED,QAAIiB,eAAe,CAACjB,CAAD,CAAf,CAAmBW,CAAnB,GAAuBjC,EAA3B,EAA+B;AAC7BwC,MAAAA,QAAQ,CAACH,IAAT,CAAcE,eAAe,CAACjB,CAAD,CAA7B;AACD,KAFD,MAEO;AACLmB,MAAAA,SAAS,CAACJ,IAAV,CAAeE,eAAe,CAACjB,CAAD,CAA9B;AACD;AACF;;AAEDxB,EAAAA,gBAAgB,CAAC2C,SAAD,EAAYzC,EAAZ,EAAgBC,EAAhB,EAAoBC,CAApB,EAAuB,CAAvB,EAA0BE,SAA1B,EAAqCC,UAArC,CAAhB;AACAP,EAAAA,gBAAgB,CAAC0C,QAAD,EAAWxC,EAAX,EAAeC,EAAf,EAAmBC,CAAnB,EAAsB,CAAC,CAAvB,EAA0BE,SAA1B,EAAqCC,UAArC,CAAhB;;AAEA,OAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiB,eAAe,CAACf,MAApC,EAA4CF,CAAC,EAA7C,EAAiD;AAC/C,QAAIoB,gBAAgB,CAACH,eAAe,CAACjB,CAAD,CAAhB,CAApB,EAA0C;AACxC;AACD;;AAED,QAAIqB,UAAU,GAAGJ,eAAe,CAACjB,CAAD,CAAf,CAAmBqB,UAApC;;AAEA,QAAIA,UAAJ,EAAgB;AACd,UAAIC,IAAI,GAAGD,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAA9B;;AAEA,UAAIJ,eAAe,CAACjB,CAAD,CAAf,CAAmBW,CAAnB,GAAuBjC,EAA3B,EAA+B;AAC7B2C,QAAAA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBJ,eAAe,CAACjB,CAAD,CAAf,CAAmBW,CAAnB,GAAuB,CAA1C;AACD,OAFD,MAEO;AACLU,QAAAA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBJ,eAAe,CAACjB,CAAD,CAAf,CAAmBW,CAAnB,GAAuB,CAA1C;AACD;;AAEDU,MAAAA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBJ,eAAe,CAACjB,CAAD,CAAf,CAAmBb,CAAzD;AACAkC,MAAAA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,IAAmBC,IAAtC;AACD;AACF;AACF;;AAED,SAASF,gBAAT,CAA0BG,MAA1B,EAAkC;AAChC;AACA,SAAOA,MAAM,CAACC,QAAP,KAAoB,QAA3B;AACD;;AAED,SAASC,QAAT,CAAkBC,WAAlB,EAA+B9C,CAA/B,EAAkCE,SAAlC,EAA6CC,UAA7C,EAAyD;AACvD,MAAI4C,IAAI,GAAGD,WAAW,CAACE,OAAZ,EAAX;AACA,MAAIX,eAAe,GAAG,EAAtB;AACA,MAAIvC,EAAJ;AACA,MAAIC,EAAJ;AACA,MAAIkD,cAAc,GAAG,KAArB;AACAF,EAAAA,IAAI,CAACG,IAAL,CAAU,UAAUC,GAAV,EAAe;AACvB,QAAIR,MAAM,GAAGI,IAAI,CAACK,aAAL,CAAmBD,GAAnB,CAAb;AACA,QAAIE,SAAS,GAAGN,IAAI,CAACO,YAAL,CAAkBH,GAAlB,CAAhB;AACA,QAAII,UAAU,GAAGF,SAAS,CAACG,QAAV,CAAmB,OAAnB,CAAjB,CAHuB,CAGuB;;AAE9C,QAAIC,aAAa,GAAGF,UAAU,CAACG,GAAX,CAAe,UAAf,KAA8BL,SAAS,CAACK,GAAV,CAAc,yBAAd,CAAlD;AACA,QAAIC,cAAc,GAAGN,SAAS,CAACG,QAAV,CAAmB,WAAnB,CAArB;AACA,QAAII,YAAY,GAAGD,cAAc,CAACD,GAAf,CAAmB,QAAnB,CAAnB;AACA,QAAIG,aAAa,GAAGF,cAAc,CAACD,GAAf,CAAmB,SAAnB,CAApB;AACA,QAAII,QAAQ,GAAG,CAACnB,MAAM,CAACoB,UAAP,GAAoBpB,MAAM,CAACqB,QAA5B,IAAwC,CAAvD;AACA,QAAIC,EAAE,GAAGzC,IAAI,CAAC0C,GAAL,CAASJ,QAAT,CAAT;AACA,QAAIK,EAAE,GAAG3C,IAAI,CAAC4C,GAAL,CAASN,QAAT,CAAT;AACA,QAAIO,KAAJ;AACA,QAAIC,KAAJ;AACA,QAAI7B,UAAJ;AACA,QAAI8B,SAAJ;AACAzE,IAAAA,EAAE,GAAG6C,MAAM,CAAC7C,EAAZ;AACAC,IAAAA,EAAE,GAAG4C,MAAM,CAAC5C,EAAZ;AACA,QAAIyE,aAAa,GAAGf,aAAa,KAAK,QAAlB,IAA8BA,aAAa,KAAK,OAApE;;AAEA,QAAIA,aAAa,KAAK,QAAtB,EAAgC;AAC9BY,MAAAA,KAAK,GAAG1B,MAAM,CAAC7C,EAAf;AACAwE,MAAAA,KAAK,GAAG3B,MAAM,CAAC5C,EAAf;AACAwE,MAAAA,SAAS,GAAG,QAAZ;AACD,KAJD,MAIO;AACL,UAAIE,EAAE,GAAG,CAACD,aAAa,GAAG,CAAC7B,MAAM,CAAC3C,CAAP,GAAW2C,MAAM,CAAC+B,EAAnB,IAAyB,CAAzB,GAA6BT,EAAhC,GAAqCtB,MAAM,CAAC3C,CAAP,GAAWiE,EAA9D,IAAoEnE,EAA7E;AACA,UAAI6E,EAAE,GAAG,CAACH,aAAa,GAAG,CAAC7B,MAAM,CAAC3C,CAAP,GAAW2C,MAAM,CAAC+B,EAAnB,IAAyB,CAAzB,GAA6BP,EAAhC,GAAqCxB,MAAM,CAAC3C,CAAP,GAAWmE,EAA9D,IAAoEpE,EAA7E;AACAsE,MAAAA,KAAK,GAAGI,EAAE,GAAGR,EAAE,GAAG,CAAlB;AACAK,MAAAA,KAAK,GAAGK,EAAE,GAAGR,EAAE,GAAG,CAAlB;;AAEA,UAAI,CAACK,aAAL,EAAoB;AAClB;AACA,YAAII,EAAE,GAAGH,EAAE,GAAGR,EAAE,IAAIL,YAAY,GAAG5D,CAAf,GAAmB2C,MAAM,CAAC3C,CAA9B,CAAhB;AACA,YAAI6E,EAAE,GAAGF,EAAE,GAAGR,EAAE,IAAIP,YAAY,GAAG5D,CAAf,GAAmB2C,MAAM,CAAC3C,CAA9B,CAAhB;AACA,YAAI8E,EAAE,GAAGF,EAAE,GAAG,CAACX,EAAE,GAAG,CAAL,GAAS,CAAC,CAAV,GAAc,CAAf,IAAoBJ,aAAlC;AACA,YAAIkB,EAAE,GAAGF,EAAT;AACAR,QAAAA,KAAK,GAAGS,EAAE,IAAIb,EAAE,GAAG,CAAL,GAAS,CAAC,CAAV,GAAc,CAAlB,CAAV;AACAK,QAAAA,KAAK,GAAGS,EAAR;AACAtC,QAAAA,UAAU,GAAG,CAAC,CAACgC,EAAD,EAAKE,EAAL,CAAD,EAAW,CAACC,EAAD,EAAKC,EAAL,CAAX,EAAqB,CAACC,EAAD,EAAKC,EAAL,CAArB,CAAb;AACD;;AAEDR,MAAAA,SAAS,GAAGC,aAAa,GAAG,QAAH,GAAcP,EAAE,GAAG,CAAL,GAAS,MAAT,GAAkB,OAAzD;AACD;;AAED,QAAIe,IAAI,GAAGzB,UAAU,CAAC0B,OAAX,EAAX;AACA,QAAIC,WAAW,GAAG3B,UAAU,CAACG,GAAX,CAAe,QAAf,IAA2BO,EAAE,GAAG,CAAL,GAAS,CAACH,QAAD,GAAYtC,IAAI,CAAC2D,EAA1B,GAA+B,CAACrB,QAA3D,GAAsE,CAAxF;AACA,QAAIsB,IAAI,GAAGtC,WAAW,CAACuC,iBAAZ,CAA8BlC,GAA9B,EAAmC,QAAnC,KAAgDJ,IAAI,CAACuC,OAAL,CAAanC,GAAb,CAA3D;AACA,QAAIoC,QAAQ,GAAG7F,WAAW,CAAC8F,eAAZ,CAA4BJ,IAA5B,EAAkCJ,IAAlC,EAAwCT,SAAxC,EAAmD,KAAnD,CAAf;AACAtB,IAAAA,cAAc,GAAG,CAAC,CAACiC,WAAnB;AACAvC,IAAAA,MAAM,CAAC8C,KAAP,GAAe;AACb1D,MAAAA,CAAC,EAAEsC,KADU;AAEb9D,MAAAA,CAAC,EAAE+D,KAFU;AAGb1B,MAAAA,QAAQ,EAAEa,aAHG;AAIb5C,MAAAA,MAAM,EAAE0E,QAAQ,CAAC1E,MAJJ;AAKba,MAAAA,GAAG,EAAEkC,YALQ;AAMbhC,MAAAA,IAAI,EAAEiC,aANO;AAObpB,MAAAA,UAAU,EAAEA,UAPC;AAQb8B,MAAAA,SAAS,EAAEA,SARE;AASbmB,MAAAA,aAAa,EAAE,QATF;AAUbC,MAAAA,QAAQ,EAAET,WAVG;AAWbU,MAAAA,MAAM,EAAEpB;AAXK,KAAf,CAjDuB,CA6DpB;;AAEH,QAAI,CAACA,aAAL,EAAoB;AAClBnC,MAAAA,eAAe,CAACF,IAAhB,CAAqBQ,MAAM,CAAC8C,KAA5B;AACD;AACF,GAlED;;AAoEA,MAAI,CAACxC,cAAD,IAAmBH,WAAW,CAACY,GAAZ,CAAgB,mBAAhB,CAAvB,EAA6D;AAC3DtB,IAAAA,YAAY,CAACC,eAAD,EAAkBvC,EAAlB,EAAsBC,EAAtB,EAA0BC,CAA1B,EAA6BE,SAA7B,EAAwCC,UAAxC,CAAZ;AACD;AACF;;AAED0F,MAAM,CAACC,OAAP,GAAiBjD,QAAjB","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar textContain = require(\"zrender/lib/contain/text\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// FIXME emphasis label position is not same with normal label position\nfunction adjustSingleSide(list, cx, cy, r, dir, viewWidth, viewHeight) {\n  list.sort(function (a, b) {\n    return a.y - b.y;\n  });\n\n  function shiftDown(start, end, delta, dir) {\n    for (var j = start; j < end; j++) {\n      list[j].y += delta;\n\n      if (j > start && j + 1 < end && list[j + 1].y > list[j].y + list[j].height) {\n        shiftUp(j, delta / 2);\n        return;\n      }\n    }\n\n    shiftUp(end - 1, delta / 2);\n  }\n\n  function shiftUp(end, delta) {\n    for (var j = end; j >= 0; j--) {\n      list[j].y -= delta;\n\n      if (j > 0 && list[j].y > list[j - 1].y + list[j - 1].height) {\n        break;\n      }\n    }\n  }\n\n  function changeX(list, isDownList, cx, cy, r, dir) {\n    var lastDeltaX = dir > 0 ? isDownList // right-side\n    ? Number.MAX_VALUE // down\n    : 0 // up\n    : isDownList // left-side\n    ? Number.MAX_VALUE // down\n    : 0; // up\n\n    for (var i = 0, l = list.length; i < l; i++) {\n      var deltaY = Math.abs(list[i].y - cy);\n      var length = list[i].len;\n      var length2 = list[i].len2;\n      var deltaX = deltaY < r + length ? Math.sqrt((r + length + length2) * (r + length + length2) - deltaY * deltaY) : Math.abs(list[i].x - cx);\n\n      if (isDownList && deltaX >= lastDeltaX) {\n        // right-down, left-down\n        deltaX = lastDeltaX - 10;\n      }\n\n      if (!isDownList && deltaX <= lastDeltaX) {\n        // right-up, left-up\n        deltaX = lastDeltaX + 10;\n      }\n\n      list[i].x = cx + deltaX * dir;\n      lastDeltaX = deltaX;\n    }\n  }\n\n  var lastY = 0;\n  var delta;\n  var len = list.length;\n  var upList = [];\n  var downList = [];\n\n  for (var i = 0; i < len; i++) {\n    delta = list[i].y - lastY;\n\n    if (delta < 0) {\n      shiftDown(i, len, -delta, dir);\n    }\n\n    lastY = list[i].y + list[i].height;\n  }\n\n  if (viewHeight - lastY < 0) {\n    shiftUp(len - 1, lastY - viewHeight);\n  }\n\n  for (var i = 0; i < len; i++) {\n    if (list[i].y >= cy) {\n      downList.push(list[i]);\n    } else {\n      upList.push(list[i]);\n    }\n  }\n\n  changeX(upList, false, cx, cy, r, dir);\n  changeX(downList, true, cx, cy, r, dir);\n}\n\nfunction avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight) {\n  var leftList = [];\n  var rightList = [];\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    if (labelLayoutList[i].x < cx) {\n      leftList.push(labelLayoutList[i]);\n    } else {\n      rightList.push(labelLayoutList[i]);\n    }\n  }\n\n  adjustSingleSide(rightList, cx, cy, r, 1, viewWidth, viewHeight);\n  adjustSingleSide(leftList, cx, cy, r, -1, viewWidth, viewHeight);\n\n  for (var i = 0; i < labelLayoutList.length; i++) {\n    if (isPositionCenter(labelLayoutList[i])) {\n      continue;\n    }\n\n    var linePoints = labelLayoutList[i].linePoints;\n\n    if (linePoints) {\n      var dist = linePoints[1][0] - linePoints[2][0];\n\n      if (labelLayoutList[i].x < cx) {\n        linePoints[2][0] = labelLayoutList[i].x + 3;\n      } else {\n        linePoints[2][0] = labelLayoutList[i].x - 3;\n      }\n\n      linePoints[1][1] = linePoints[2][1] = labelLayoutList[i].y;\n      linePoints[1][0] = linePoints[2][0] + dist;\n    }\n  }\n}\n\nfunction isPositionCenter(layout) {\n  // Not change x for center label\n  return layout.position === 'center';\n}\n\nfunction _default(seriesModel, r, viewWidth, viewHeight) {\n  var data = seriesModel.getData();\n  var labelLayoutList = [];\n  var cx;\n  var cy;\n  var hasLabelRotate = false;\n  data.each(function (idx) {\n    var layout = data.getItemLayout(idx);\n    var itemModel = data.getItemModel(idx);\n    var labelModel = itemModel.getModel('label'); // Use position in normal or emphasis\n\n    var labelPosition = labelModel.get('position') || itemModel.get('emphasis.label.position');\n    var labelLineModel = itemModel.getModel('labelLine');\n    var labelLineLen = labelLineModel.get('length');\n    var labelLineLen2 = labelLineModel.get('length2');\n    var midAngle = (layout.startAngle + layout.endAngle) / 2;\n    var dx = Math.cos(midAngle);\n    var dy = Math.sin(midAngle);\n    var textX;\n    var textY;\n    var linePoints;\n    var textAlign;\n    cx = layout.cx;\n    cy = layout.cy;\n    var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';\n\n    if (labelPosition === 'center') {\n      textX = layout.cx;\n      textY = layout.cy;\n      textAlign = 'center';\n    } else {\n      var x1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dx : layout.r * dx) + cx;\n      var y1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dy : layout.r * dy) + cy;\n      textX = x1 + dx * 3;\n      textY = y1 + dy * 3;\n\n      if (!isLabelInside) {\n        // For roseType\n        var x2 = x1 + dx * (labelLineLen + r - layout.r);\n        var y2 = y1 + dy * (labelLineLen + r - layout.r);\n        var x3 = x2 + (dx < 0 ? -1 : 1) * labelLineLen2;\n        var y3 = y2;\n        textX = x3 + (dx < 0 ? -5 : 5);\n        textY = y3;\n        linePoints = [[x1, y1], [x2, y2], [x3, y3]];\n      }\n\n      textAlign = isLabelInside ? 'center' : dx > 0 ? 'left' : 'right';\n    }\n\n    var font = labelModel.getFont();\n    var labelRotate = labelModel.get('rotate') ? dx < 0 ? -midAngle + Math.PI : -midAngle : 0;\n    var text = seriesModel.getFormattedLabel(idx, 'normal') || data.getName(idx);\n    var textRect = textContain.getBoundingRect(text, font, textAlign, 'top');\n    hasLabelRotate = !!labelRotate;\n    layout.label = {\n      x: textX,\n      y: textY,\n      position: labelPosition,\n      height: textRect.height,\n      len: labelLineLen,\n      len2: labelLineLen2,\n      linePoints: linePoints,\n      textAlign: textAlign,\n      verticalAlign: 'middle',\n      rotation: labelRotate,\n      inside: isLabelInside\n    }; // Not layout the inside label\n\n    if (!isLabelInside) {\n      labelLayoutList.push(layout.label);\n    }\n  });\n\n  if (!hasLabelRotate && seriesModel.get('avoidLabelOverlap')) {\n    avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight);\n  }\n}\n\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}